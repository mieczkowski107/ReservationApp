@using ReservationApp.Utility
@model List<Appointment>

<div class="container">
    <div class="row pt-4 pb-3">
        <div class="col-6">
            <h2 class=" text-primary">
                Appointment's List
            </h2>
        </div>
    </div>
</div>

<table class="table table-striped table-bordered text-center justify-content-center shadow">
    <thead>
        <tr>
            <th class="table-info">
                Company Name
            </th>
            <th class="table-info">
                Service Name
            </th>
            <th class="table-info">
                Date
            </th>
            <th class="table-info">
                Hour
            </th>
            <th class="table-info">
                Status
            </th>
            <th class="table-info">
                Actions
            </th>
        </tr>
    </thead>
    <tbody class="w-auto">
        @foreach (var item in Model)
        {
            <tr class="w-auto">
                <td>
                    @item.Service.Company.Name
                </td>
                <td class="w-auto">
                    @item.Service.Name
                </td>
                <td class="w-auto">
                    @item.Date
                </td>
                <td class="w-auto">
                    @item.Time
                </td>
                <td>
                    <div class="btn status-btn" data-status="@item.Status" style="pointer-events: none;">
                        @item.Status
                    </div>
                    @if (item.Status == AppointmentStatus.Pending && item.Service.IsPrepaymentRequired)
                    {
                        <br />
                        <span class="badge bg-warning text-dark text-center">Payment required</span>
                    }
                </td>
                <td class="">
                    <div class="justify-content-center">
                        @if (item.Status == AppointmentStatus.Pending && item.Service.IsPrepaymentRequired)
                        {
                            <a asp-controller="Appointment" asp-action="Payment" asp-route-id="@item.Id" class="btn btn-outline-info mx-2 w-auto">Payment<i class="bi bi-credit-card"></i></a>
                        }
                        @if (item.Status == AppointmentStatus.Pending && !item.Service.IsPrepaymentRequired)
                        {
                            <a asp-controller="Appointment" asp-action="Details" asp-route-id="@item.Id" class="btn btn-primary mx-2 w-auto"> Click to confirm <i class="bi bi-check-lg"></i></a>
                        }
                        else if (item.Status == AppointmentStatus.Confirmed || item.Status == AppointmentStatus.Cancelled || item.Status == AppointmentStatus.NoShow || item.Status == AppointmentStatus.Completed)
                        {
                            <a asp-controller="Appointment" asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-primary mx-2 w-auto"> Details <i class="bi bi-search"></i></a>
                        }

                        
                    </div>

                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts
{
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Select all buttons with the 'status-btn' class
            var statusButtons = document.querySelectorAll('.status-btn');

            // Loop through each button and update its class based on the data-status
            statusButtons.forEach(function (btn) {
                var status = btn.getAttribute('data-status');

                // Update the button class based on the status
                if (status === 'Pending') {
                    btn.classList.add('btn-outline-warning');
                } else if (status === 'Paid') {
                    btn.classList.add('btn-outline-primary');
                } else if (status === 'Confirmed') {
                    btn.classList.add('btn-outline-success');
                } else if (status === 'Completed') {
                    btn.classList.add('btn-success');
                } else if (status === 'Cancelled') {
                    btn.classList.add('btn-outline-danger');
                } else if(status === 'NoShow'){
                    btn.classList.add('btn-outline-info');
                }
            });
        });
    </script>

}